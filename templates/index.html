<!DOCTYPE html>
<html>
<head>
    <title>Text to mp3+srt</title>
    <style>
        .error {
            color: red;
        }
    </style>
</head>
<body>
<div>
    <h1>Multilingual Voiceover Assistant</h1>
</div>
<a href="/help"><h2>Help</h2></a>
<br><br>

<form action="/" method="post">
    <input name="orig_lang" value="{{ orig_lang }}" hidden>
    <input type="submit" name="reset" value="Clear the form and start over" style="background-color: red; color: white;">
    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}
    <h2>Step 1:</h2>
    <h3>Select original language:</h3>
<!--    <select name="language" id="language" onchange="handleLanguageChange(languageList, voiceList)">-->
    <select name="select_orig_lang" id="orig_lang">
<!--    <select name="orig_lang" id="orig_lang" disabled>-->
        {% for lang_code, name in supported_langs.items() %}
            <option value="{{lang_code}}" {% if lang_code == orig_lang %}selected{% endif %}>{{name}}</option>
        {% endfor %}
    </select>

    <br><br>

    <h2>Step 2:</h2>
    <h3>Enter text script here:</h3>
    <textarea name="textarea" id="textarea" rows="25" cols="150" spellcheck="false">{% if text %}{{text}}{% endif %}</textarea>
    <br><br>
    <h2>Step 3:</h2>
    <h3>Add translation to other languages:</h3>
    <select name="added_lang" id="added_lang">
        {% for lang_code, name in supported_langs.items() %}
            <option value="{{lang_code}}" {% if lang_code in present_langs %}hidden{% endif %}>{{name}}</option>
        {% endfor %}
    </select>
    <input type="submit" value="Add Language" name="add_lang" onclick="showElement('wait_translation');">
    <div id="wait_translation" hidden>Translating... Please wait...</div>
    <br><br>
    <h2>Step 4:</h2>
    <h3>Choose voice for each language:</h3>
    <table>
        {% for lang in present_langs %}
            <tr>
                <td>
                    {{ lang }}:
                </td>
                <td>
                    <select name="voice_{{lang}}" id="voice_{{lang}}">
                        {% for voice in voices[lang] %}
                                <option value="{{voice}}">{{voice}}</option>
                        {% endfor %}
                    </select>
                 </td>
            </tr>
        {% endfor %}

    </table>
    <h2>Step 5:</h2>
    <h3>Click and wait. Zip file download will start shortly.</h3>
    <div>Please be patient, as the preparation process may take some time. The download will start automatically once the files are ready.</div>
    <br>
    <input type="submit" value="Generate and Download File">
</form>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var selectElement = document.getElementById('orig_lang');

        selectElement.addEventListener('change', function() {
            var selectedValue = selectElement.value;

            // Create an AJAX request
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/change_orig_lang', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

            // Send the selected value
            xhr.send('selectedValue=' + encodeURIComponent(selectedValue));

            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
                    // Parse the JSON response
                    var response = JSON.parse(xhr.responseText);

                    // Replace the current document with the updated content
                    document.open();
                    document.write(response.content);
                    document.close();
                }
            };
        });
    });
</script>
<script>
    function showElement(id) {
        document.getElementById(id).style.display = 'block';
    }
</script>
</body>
</html>